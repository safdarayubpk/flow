# Data Model: Full-Stack Multi-User Web Application for Todo App

**Feature**: 002-fullstack-todo-app
**Date**: 2026-01-19

## Overview
This document defines the data model for the full-stack multi-user todo application, including entity definitions, relationships, and validation rules.

## Entity Definitions

### User Entity
Represents a registered user with email, password, and account details managed by Better Auth

**Fields**:
- `id`: str (primary key, auto-generated by Better Auth)
- `email`: str (unique, required, indexed)
- `password_hash`: str (hashed, required)
- `created_at`: datetime (timestamp, required)
- `updated_at`: datetime (timestamp, required, auto-updated)

**Relationships**:
- One-to-many with Task entity (one user to many tasks)

**Validation Rules**:
- Email must be valid email format
- Email must be unique across all users
- Password must meet security requirements (min 8 chars, upper, lower, number, special char)

### Task Entity
Represents a todo item with id, user_id (foreign key reference), title (1-200 chars), optional description, completion status (boolean), and timestamps (created_at, updated_at)

**Fields**:
- `id`: int (primary key, auto-increment)
- `user_id`: str (foreign key reference to User.id, required, indexed)
- `title`: str (required, 1-200 characters)
- `description`: str (optional, nullable)
- `completed`: bool (default false)
- `created_at`: datetime (timestamp, required)
- `updated_at`: datetime (timestamp, required, auto-updates on change)

**Validation Rules**:
- Title must be between 1-200 characters
- User_id must reference an existing user
- Only the task owner can modify/delete the task
- Completed status can be toggled by the task owner

**State Transitions**:
- New task: `completed` = false by default
- Task completion: `completed` = true when toggled
- Task uncompletion: `completed` = false when toggled

## Relationships

### User â†’ Task
- One-to-many relationship
- A user can own multiple tasks
- Tasks are isolated by user_id, ensuring data privacy
- When a user is deleted, their tasks should also be deleted (cascade delete)

## Indexes

### Required Indexes
- `user_id` on Task table: For efficient filtering by user in queries
- `completed` on Task table: For efficient filtering by completion status
- `email` on User table: For efficient user lookup during authentication

## Data Integrity Constraints

### Referential Integrity
- Task.user_id must reference an existing User.id
- Prevent orphaned tasks that don't belong to any user

### Business Logic Constraints
- Users can only access/modify their own tasks
- Task titles must be within 1-200 character range
- Creation timestamps are immutable after initial creation

## API Contract Requirements

### Data Validation
- All API endpoints must validate incoming data against the model constraints
- Return appropriate error codes for validation failures
- Sanitize all inputs to prevent injection attacks

### Response Formats
- API responses must include all relevant fields as defined in the model
- Timestamps should be in ISO 8601 format
- Boolean values should be true/false (lowercase)

## Security Considerations

### Data Isolation
- All database queries must include WHERE clause filtering by user_id
- Never return tasks that don't belong to the authenticated user
- Implement row-level security at the application layer

### Field Sensitivity
- Password hashes must never be exposed in API responses
- User emails may be exposed if needed for the application but with proper authorization